<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; font-src 'self' data:; img-src 'self' data:;">
  <title>Claude Lens</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <span class="logo">Claude Lens</span>
        <span id="appVersion" class="version"></span>
        <div class="project-dropdown-container">
          <select id="projectDropdown" class="project-dropdown" title="Switch project">
            <option value="">No project</option>
          </select>
        </div>
      </div>
      <div class="header-center">
        <input type="text" id="urlInput" class="url-input" placeholder="http://localhost:3000" value="http://localhost:3000">
        <button id="goBtn" class="btn" title="Navigate to URL (Enter)">Go</button>
        <button id="refreshBtn" class="btn" title="Refresh page (Ctrl+R)">↻</button>
        <button id="restartServerBtn" class="btn" title="Restart dev server" disabled>⟳</button>
      </div>
      <div class="header-right">
        <div class="status-bar">
          <span id="projectStatus" class="status-item hidden" title="Current project"></span>
          <span id="serverStatus" class="status-item hidden" title="Click to copy URL"></span>
          <span id="playwrightStatus" class="status-item hidden" title="Playwright automation status"></span>
          <span id="viewportStatus" class="status-item hidden" title="Current viewport width"></span>
          <span id="status" class="status">Disconnected</span>
        </div>
      </div>
    </header>

    <!-- Main Content - Three Columns -->
    <div class="main">
      <!-- Browser Panel (Left) -->
      <div class="panel browser-panel">
        <div class="panel-header">
          <span>Browser</span>
          <span id="browserHelpText" class="browser-help-text"></span>
          <div class="panel-header-actions">
            <select id="viewportSelect" class="viewport-select" title="Device viewport">
              <option value="full">Full Width</option>
              <option value="desktop">Desktop (1280px)</option>
              <option value="tablet-landscape">Tablet Landscape (1024px)</option>
              <option value="tablet">Tablet (768px)</option>
              <option value="mobile-large">Mobile L (425px)</option>
              <option value="mobile">Mobile (375px)</option>
            </select>
            <button id="inspectBtn" class="btn btn-small" title="Toggle inspect mode (or Ctrl+hover)">Inspect</button>
            <button id="freezeHoverBtn" class="btn btn-small" title="Press F to freeze hover states (tooltips, menus)">Freeze (F)</button>
            <button id="consoleToggleBtn" class="btn btn-small">Console</button>
          </div>
        </div>
        <div class="panel-content">
          <div id="placeholder" class="placeholder">
            <div class="placeholder-icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
              </svg>
            </div>
            <div class="placeholder-title">Browser Preview</div>
            <div class="placeholder-text">Enter a localhost URL and click Go</div>
          </div>
          <!-- Loading Overlay -->
          <div id="loadingOverlay" class="loading-overlay hidden">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading...</div>
          </div>
          <!-- BrowserView renders here via Electron -->
        </div>
        <!-- Console Drawer (bottom of browser) -->
        <div id="consoleDrawer" class="console-drawer hidden">
          <div class="console-drawer-header">
            <span>Console</span>
            <div class="console-drawer-actions">
              <span id="consoleDrawerCount" class="console-count">0</span>
              <button id="consoleClearBtn" class="btn btn-small">Clear</button>
              <button id="consoleSendBtn" class="btn btn-small btn-primary">Send to Claude</button>
            </div>
          </div>
          <div id="consoleDrawerMessages" class="console-drawer-content"></div>
        </div>
      </div>

      <!-- Resizer 1 -->
      <div class="resizer" id="resizer1"></div>

      <!-- Context Panel (Middle) -->
      <div class="panel context-panel">
        <div class="panel-header">
          <span>Context</span>
          <select id="contextModeSelect" class="context-mode-select" title="Context detail level sent to Claude">
            <option value="lean">Optimised</option>
            <option value="detailed">Detailed</option>
          </select>
        </div>
        <div class="panel-content" id="contextContent">
          <!-- Element Description Section (Human-readable) -->
          <div id="descriptionInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">WHAT IS THIS?</span>
            </div>
            <div class="section-content">
              <span id="elementDescription" class="element-description"></span>
            </div>
          </div>

          <!-- Element Info Section -->
          <div id="elementInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">ELEMENT</span>
            </div>
            <div class="section-content">
              <code id="elementTag" class="element-tag"></code>
            </div>
          </div>

          <!-- Component Info Section (React/Vue) -->
          <div id="componentInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">COMPONENT</span>
              <span id="frameworkBadge" class="framework-badge"></span>
              <button id="copyComponentBtn" class="copy-btn" title="Copy component info">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
              </button>
            </div>
            <div class="section-content" id="componentList"></div>
          </div>

          <!-- Source Location Section -->
          <div id="sourceInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">SOURCE</span>
              <span id="sourceStatus" class="source-status"></span>
            </div>
            <div class="section-content">
              <div id="sourceAvailable" class="source-available hidden">
                <code id="sourceLocation" class="source-location"></code>
                <button id="copySourceBtn" class="copy-btn" title="Copy source location">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                </button>
              </div>
              <div id="sourceUnavailable" class="source-unavailable hidden">
                <span class="source-warning">Component not found in source files</span>
              </div>
              <div id="sourceNoFramework" class="source-no-framework hidden">
                <span class="source-hint">Select a React/Vue component to see source location</span>
              </div>
            </div>
          </div>

          <!-- Parent Hierarchy Section -->
          <div id="hierarchyInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">WHERE IS IT?</span>
            </div>
            <div class="section-content" id="hierarchyList"></div>
          </div>

          <!-- Path Section -->
          <div id="pathInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">SELECTOR</span>
              <button id="copySelectorBtn" class="copy-btn" title="Copy selector">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
              </button>
            </div>
            <div class="section-content">
              <code id="elementPath" class="element-path"></code>
            </div>
          </div>

          <!-- Attributes Section -->
          <div id="attributesInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">ATTRIBUTES</span>
            </div>
            <div class="section-content" id="attributesList"></div>
          </div>

          <!-- Styles Section -->
          <div id="stylesInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">COMPUTED STYLES</span>
            </div>
            <div class="section-content" id="stylesList"></div>
          </div>

          <!-- Position/Size Section -->
          <div id="positionInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">POSITION & SIZE</span>
            </div>
            <div class="section-content" id="positionData"></div>
          </div>

          <!-- Inner Text Section -->
          <div id="textInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">INNER TEXT</span>
            </div>
            <div class="section-content">
              <span id="innerText" class="inner-text"></span>
            </div>
          </div>

          <!-- Form State Section (Phase 3) -->
          <div id="formStateInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">FORM STATE</span>
              <span id="validationBadge" class="validation-badge"></span>
            </div>
            <div class="section-content" id="formStateContent"></div>
          </div>

          <!-- Overlay/Modal Info Section (Phase 4) -->
          <div id="overlayInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">OVERLAY CONTEXT</span>
              <span id="overlayTypeBadge" class="overlay-badge"></span>
            </div>
            <div class="section-content" id="overlayContent"></div>
          </div>

          <!-- Z-Index Stacking Section (Phase 4) -->
          <div id="stackingInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">STACKING CONTEXT</span>
              <span id="zIndexBadge" class="zindex-badge"></span>
            </div>
            <div class="section-content" id="stackingContent"></div>
          </div>

          <!-- Scroll Context Section (Phase 4) -->
          <div id="scrollInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">SCROLL & VISIBILITY</span>
              <span id="visibilityBadge" class="visibility-badge"></span>
            </div>
            <div class="section-content" id="scrollContent"></div>
          </div>

          <!-- iFrame Context Section (Phase 4) -->
          <div id="iframeInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">IFRAME CONTEXT</span>
            </div>
            <div class="section-content" id="iframeContent"></div>
          </div>

          <!-- Shadow DOM Section (Phase 4) -->
          <div id="shadowDOMInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">SHADOW DOM</span>
            </div>
            <div class="section-content" id="shadowDOMContent"></div>
          </div>

          <!-- Toast Captures Section (Phase 4) -->
          <div id="toastCapturesInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">CAPTURED TOASTS</span>
              <span id="toastCount" class="toast-count">0</span>
            </div>
            <div class="section-content" id="toastCapturesList"></div>
            <div class="toast-actions">
              <button id="clearToastsBtn" class="btn btn-small">Clear</button>
              <button id="sendToastsBtn" class="btn btn-small btn-primary">Send to Claude</button>
            </div>
          </div>

          <!-- Empty State -->
          <div id="contextEmpty" class="context-empty">
            <div class="empty-icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="6"></circle>
                <circle cx="12" cy="12" r="2"></circle>
              </svg>
            </div>
            <div class="empty-text">Click "Inspect" then select an element</div>
            <div class="empty-hint">or Ctrl+Click any element for quick capture</div>
          </div>

          <!-- Inspect Sequence (shown during multi-click inspect) -->
          <div id="inspectSequenceInfo" class="context-section hidden">
            <div class="section-header">
              <span class="section-title">CAPTURED INTERACTIONS</span>
              <span id="sequenceCount" class="sequence-count">0</span>
            </div>
            <div class="section-content" id="inspectSequenceList"></div>
            <div class="sequence-actions">
              <button id="clearSequenceBtn" class="btn btn-small">Clear</button>
              <button id="sendSequenceBtn" class="btn btn-small btn-primary">Send Sequence</button>
            </div>
          </div>
        </div>

        <!-- Element Chips -->
        <div class="element-chips" id="elementChips"></div>

        <!-- Prompt Input -->
        <div class="prompt-area">
          <textarea id="promptInput" class="prompt-textarea" placeholder="What should Claude do with this element?"></textarea>
          <div class="prompt-actions">
            <button id="sendPromptBtn" class="btn btn-primary" title="Send to Claude (Enter)">Send to Claude</button>
          </div>
        </div>
      </div>

      <!-- Resizer 2 -->
      <div class="resizer" id="resizer2"></div>

      <!-- Claude Panel (Right) -->
      <div class="panel claude-panel">
        <div class="panel-header">
          <span>Claude Code</span>
          <span id="thinkingIndicator" class="thinking-indicator hidden">
            <span class="thinking-dot"></span>
            <span class="thinking-text">Thinking...</span>
          </span>
          <button id="startClaudeBtn" class="btn btn-small">Start Claude</button>
        </div>
        <div class="panel-content">
          <div id="terminal" class="terminal"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./main.ts"></script>
</body>
</html>
